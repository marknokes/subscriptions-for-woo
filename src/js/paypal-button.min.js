var ppsfwooSubscribeButton=document.getElementById("subscribeButton"),ppsfwooEllipsis=document.getElementById("lds-ellipsis"),ppsfwooShortcodeContainer=document.getElementById("ppsfwoo-shortcode-button-container");function ppsfwooSendPostRequest(a,s){return new Promise((e,t)=>{var o,n=new XMLHttpRequest,r=(n.onreadystatechange=function(){if(n.readyState===XMLHttpRequest.DONE)if(200===n.status)try{var o=JSON.parse(n.responseText);e(o)}catch(o){t(new Error("Invalid JSON response"))}else t(new Error("Request failed: "+n.status))},n.onerror=function(){t(new Error("Network error occurred"))},new URLSearchParams);for(o in s)r.append(o,s[o]);n.open("POST",a,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(r.toString())})}function ppsfwooLoadPayPalScript(o,e,t,n){var r;window.paypal?n(e,t):((r=document.createElement("script")).setAttribute("src",`https://www.paypal.com/sdk/js?client-id=${o}&vault=true&intent=subscription`),r.setAttribute("data-sdk-integration-source","button-factory"),r.onload=function(){n(e,t)},r.onerror=function(){var o="Failed to load PayPal sdk";console.log(o),ppsfwooLogButtonError(o),alert("There has been an unexpeced error. Please refresh and try again."),location.reload()},document.body.appendChild(r))}function ppsfwooLogButtonError(o){ppsfwooSendPostRequest("/wp-admin/admin-ajax.php",{action:"ppsfwoo_admin_ajax_callback",method:"log_paypal_buttons_error",message:o}).then(o=>{console.log(o)}).catch(o=>{console.log(o)})}function ppsfwooRender(t,n){ppsfwooEllipsis&&ppsfwooEllipsis.style.setProperty("display","none","important");var o=document.createElement("div");o.setAttribute("id","paypal-button-container-"+n),ppsfwooSubscribeButton?ppsfwooSubscribeButton.insertAdjacentElement("afterend",o):ppsfwooShortcodeContainer?ppsfwooShortcodeContainer.replaceWith(o):alert("Unable to render PayPal button"),paypal.Buttons({style:{shape:"rect",layout:"vertical",color:"gold",label:"subscribe"},createSubscription:function(o,e){return e.subscription.create({plan_id:n})},onApprove:function(o,e){o=ppsfwoo_paypal_ajax_var.redirect+"?subs_id="+o.subscriptionID+"&subs_id_redirect_nonce="+t;window.location.assign(o)},onError:function(o){o.message&&ppsfwooLogButtonError(o.message)}}).render("#paypal-button-container-"+n)}function ppsfwooInitializePayPalSubscription(){ppsfwooSendPostRequest("/wp-admin/admin-ajax.php",{action:"ppsfwoo_admin_ajax_callback",method:"subs_id_redirect_nonce",product_id:ppsfwoo_paypal_ajax_var.product_id}).then(o=>{if(o.error)throw new Error("No plan id found for product with ID "+ppsfwoo_paypal_ajax_var.product_id);ppsfwooLoadPayPalScript(o.client_id,o.nonce,o.plan_id,ppsfwooRender)}).catch(o=>{console.log(o),ppsfwooLogButtonError(o),alert("There has been an unexpeced error. Please refresh and try again."),location.reload()})}ppsfwooSubscribeButton&&ppsfwooSubscribeButton.addEventListener("click",function(){this.style.display="none",ppsfwooEllipsis.style.setProperty("display","inline-block","important"),ppsfwooInitializePayPalSubscription()});
