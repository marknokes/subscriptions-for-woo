var ppsfwooQuantityInputId="ppsfwoo-quantity-input",ppsfwooSubscribeButton=document.getElementById("ppsfwoo-subscribe-button"),ppsfwooEllipsis=document.getElementById("lds-ellipsis"),ppsfwooShortcodeContainer=document.getElementById("ppsfwoo-shortcode-button-container"),ppsfwooQuantityInputContainer=document.getElementById("ppsfwoo-quantity-input-container");function ppsfwooCreateQuantityInput(){var t=document.createElement("input"),o=document.createElement("label");t.type="number",t.id=ppsfwooQuantityInputId,t.name="quantity",t.min="1",t.value="1",o.setAttribute("for",ppsfwooQuantityInputId),o.innerHTML="Quantity: ",ppsfwooQuantityInputContainer.appendChild(o).appendChild(t)}function ppsfwooSendPostRequest(p,r){return new Promise((o,e)=>{var t,n=new XMLHttpRequest,a=(n.onreadystatechange=function(){if(n.readyState===XMLHttpRequest.DONE)if(200===n.status)try{var t=JSON.parse(n.responseText);o(t)}catch(t){e(new Error("Invalid JSON response"))}else e(new Error("Request failed: "+n.status))},n.onerror=function(){e(new Error("Network error occurred"))},new URLSearchParams);for(t in r)a.append(t,r[t]);n.open("POST",p,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(a.toString())})}function ppsfwooLoadPayPalScript(t,o,e,n){var a;window.paypal?n(o,e):((a=document.createElement("script")).setAttribute("src",`https://www.paypal.com/sdk/js?client-id=${t}&vault=true&intent=subscription`),a.setAttribute("data-sdk-integration-source","button-factory"),a.onload=function(){n(o,e)},a.onerror=function(){var t="Failed to load PayPal sdk";console.log(t),ppsfwooLogButtonError(t),alert("There has been an unexpeced error. Please refresh and try again.")},document.body.appendChild(a))}function ppsfwooLogButtonError(t){ppsfwooSendPostRequest("/wp-admin/admin-ajax.php",{action:"ppsfwoo_admin_ajax_callback",method:"log_paypal_buttons_error",message:t}).then(t=>{console.log(t)}).catch(t=>{console.log(t)})}function ppsfwooRender(e,n){ppsfwooEllipsis&&ppsfwooEllipsis.style.setProperty("display","none","important");var t=document.createElement("div");t.setAttribute("id","paypal-button-container-"+n),ppsfwooSubscribeButton?ppsfwooSubscribeButton.insertAdjacentElement("afterend",t):ppsfwooShortcodeContainer?ppsfwooShortcodeContainer.replaceWith(t):alert("Unable to render PayPal button"),paypal.Buttons({style:{shape:"rect",layout:"vertical",color:"gold",label:"subscribe"},createSubscription:function(t,o){var e=document.getElementById(ppsfwooQuantityInputId),t={plan_id:n};return e&&(t.quantity=e.value),o.subscription.create(t)},onApprove:function(t,o){t=ppsfwoo_paypal_ajax_var.redirect+"?subs_id="+t.subscriptionID+"&subs_id_redirect_nonce="+e;window.location.assign(t)},onError:function(t){t.message&&ppsfwooLogButtonError(t.message)}}).render("#paypal-button-container-"+n)}function ppsfwooInitializePayPalSubscription(){ppsfwooSendPostRequest("/wp-admin/admin-ajax.php",{action:"ppsfwoo_admin_ajax_callback",method:"subs_id_redirect_nonce",product_id:ppsfwoo_paypal_ajax_var.product_id}).then(t=>{if(t.error)throw new Error("No plan id found for product with ID "+ppsfwoo_paypal_ajax_var.product_id);t.quantity_supported&&ppsfwooCreateQuantityInput(),ppsfwooLoadPayPalScript(t.client_id,t.nonce,t.plan_id,ppsfwooRender)}).catch(t=>{console.log(t),ppsfwooLogButtonError(t),alert("There has been an unexpeced error. Please refresh and try again.")})}ppsfwooSubscribeButton&&ppsfwooSubscribeButton.addEventListener("click",function(){this.style.display="none",ppsfwooEllipsis.style.setProperty("display","inline-block","important"),ppsfwooInitializePayPalSubscription()});